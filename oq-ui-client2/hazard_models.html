  <!--
 Copyright (c) 2010-2012, GEM Foundation.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/agpl.html>. -->

{% extends "page_layout.html" %}
{% load i18n %}

{% block title %} {% trans "Welcome to FaultedEarth!" %} - {{ block.super }} {% endblock %}
{% block indexclass %} class="here" {% endblock %}
        
{% block head %}

{{ block.super }}
        
	<!-- IE 8 Compatibility -->
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
        
	<!-- Google resources -->
	<script src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>

	<!-- leaflet resources -->
	<link rel="stylesheet" href="src/Leaflet/dist/leaflet.css" />
	<script type="text/javascript" src="src/Leaflet/dist/leaflet.js"></script>
	
	<!-- wax resources -->
	<script type='text/javascript' src='src/L.Wax/L.Wax.js'></script>
	<script type="text/javascript" src="src/wax/dist/wax.leaf.min.js"></script>
	<script type='text/javascript' src='src/wax/ext/modestmaps.min.js'></script>
	<script type='text/javascript' src='src/wax/dist/wax.mm.js'></script>
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}theme/wax-controls.css" media="screen" >

	<!-- jquery and other stuff -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>

{% endblock %}
	<!--Google Analytics-->
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-20718690-2']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>

{% block main %}
<div id="sidePanel-leg">
  <div id="panelContent-leg">
    <div class="map-legend-hazard">
    <p>
      <div class='legend-title'>Hazard Model<br/></div>
        <div class='legend-title-part'>Japan<br/>
        </div>
        <div class='legend-scale'>
          <ul class='legend-labels'>
            <li><span style='background:#E3E86A;'></span>0 - 20<li>
            <li><span style='background:#EADA65;'></span>20 - 30<li>
            <li><span style='background:#FFDC00;'></span>30 - 40<li>
            <li><span style='background:#EFD462;'></span>40 - 50<li>
            <li><span style='background:#F5CB5F;'></span>50 - 60<li>
            <li><span style='background:#FFB858;'></span>60 - 70<li>
            <li><span style='background:#FFAC53;'></span>70 - 80<li>
            <li><span style='background:#FF8644;'></span>80 - 90<li>
            <li><span style='background:#FF3D2F;'></span>90 100<li>
            <li><span style='background:#FF0000;'></span>100 110<li>
            <li><span style='background:#E60000;'></span>110 150<li>
            <li><span style='background:#CC0D56;'></span>150 180<li>
            <li><span style='background:#B80C4D;'></span>over 180<li>
          </ul>     
        </div>
      </div>
        <div class='legend-source'> Source: The Japan models have been produced from a GEM implementation of the latest Japan PSHA model       
        </div> </p>     
      </div>
    </div>
  </div>
 
    <div id="map" style="width: 100%;"></div>
    <script type="text/javascript">

    //resize the main and map div
    $(document).ready(function() {
        var main_height = $(window).height() - $("#header-wrapper").height() - $("#footer").height();
        var map_height = $(window).height() - $("#header-wrapper").height() - $("#footer").height() - $("#tooltip").height();
        $('#main').css("height",main_height + "px");
        $('#map').css("height",map_height + "px");
    map.invalidateSize(false);
    });

    $(document).ready(function() {
        $(window).resize(function(){
            var main_height = $(window).height() - $("#header-wrapper").height() - $("#footer").height();
            var map_height = $(window).height() - $("#header-wrapper").height() - $("#footer").height() - $("#tooltip").height();
            $('#main').css("height",main_height + "px");
            $('#map').css("height",map_height + "px");
        map.invalidateSize(false);
       });
    });

    // sliding panel for legend and dwelling fractions table
    jQuery(function($) {
    $(document).ready(function() {
        $('#panelHandle-dwel').hover(function() {
            $('#sidePanel-dwel').stop(true, false).animate({
                'left': '0px'
            }, 900);
        }, function() {
            jQuery.noConflict();
        });
 
        jQuery('#sidePanel-dwel').hover(function() {
            // Do nothing
        }, function() {
 
            jQuery.noConflict();
            jQuery('#sidePanel-dwel').animate({
                left: '-328px'
            }, 800);
 
        });
    });
    });

    // sliding panel
    jQuery(function($) {
    $(document).ready(function() {
        $('#panelHandle-leg').hover(function() {
            $('#sidePanel-leg').stop(true, false).animate({
                'left': '0px'
            }, 900);
        }, function() {
            jQuery.noConflict();
        });
 
        jQuery('#sidePanel-leg').hover(function() {
            // Do nothing
        }, function() {
 
            jQuery.noConflict();
            jQuery('#sidePanel-leg').animate({
                left: '-201px'
            }, 800);
 
        });
    });
    });

    // The map
    // base layers
    naturalEarth = L.tileLayer('http://{s}.tiles.mapbox.com/v3/mapbox.natural-earth-2/{z}/{x}/{y}.png'),

    GEM_base = L.tileLayer('http://193.206.66.82:8000/v2/world_landmass/{z}/{x}/{y}.png');

    var baselayer = {
        'Natural Earth' : naturalEarth,
        'GEM_base' : GEM Base Map
    };

    // overlay layers

    grump_rural = L.tileLayer('http://193.206.66.82:8000/v2/gdal-custom-rural/{z}/{x}/{y}.png');

    grump_urban = L.tileLayer('http://193.206.66.82:8000/v2/gdal-custom-urban/{z}/{x}/{y}.png',{opacity: 0.8});

    osm = L.tileLayer('http://{s}.tiles.mapbox.com/v3/mapbox.world-bank-borders-en/{z}/{x}/{y}.png'),

    hazard_map_japan_21 = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_21/{z}/{x}/{y}.png');

    hazard_map_japan_22 = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_22/{z}/{x}/{y}.png');

    hazard_map_japan_22_land = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_22_land/{z}/{x}/{y}.png');

    hazard_map_japan_21_land = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_21_land/{z}/{x}/{y}.png');

    hazard_map_japan_21_contour = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_21_contour/{z}/{x}/{y}.png');

    hazard_map_japan_22_contour = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_22_contour/{z}/{x}/{y}.png');

    hazard_map_japan_21_contour_land = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_21_contour_land/{z}/{x}/{y}.png');

    hazard_map_japan_22_contour_land = L.tileLayer('http://193.206.66.82:8000/v2/hazard_map_japan_22_contour_land/{z}/{x}/{y}.png');
    
    hazard_curve_Japan = L.tileLayer('http://193.206.66.82:8000/v2/hazard_curve_Japan/{z}/{x}/{y}.png', {
      wax: 'http://193.206.66.82:8000/v2/hazard_curve_Japan.json'
    });

    hazard_curve_Japan_land = L.tileLayer('http://193.206.66.82:8000/v2/hazard_curve_Japan_land/{z}/{x}/{y}.png', {
      wax: 'http://193.206.66.82:8000/v2/hazard_curve_Japan_land.json'
    });

    hazard_map = L.tileLayer('http://193.206.66.82:8000/v2/hazard-map-points-world/{z}/{x}/{y}.png');

    hazard_contour = L.tileLayer('http://193.206.66.82:8000/v2/hazard-map-contour-4/{z}/{x}/{y}.png');

    hazard_curve = L.tileLayer('http://193.206.66.82:8000/v2/hazard-curve-world-total/{z}/{x}/{y}.png', {
      wax: 'http://193.206.66.82:8000/v2/hazard-curve-world-total.json'
    });

    var overlays = {
      "OpenStreetMap" : osm, 
      "Japan Hazard Map 21" : hazard_map_japan_21,
      "Japan Hazard Map 21 Land" : hazard_map_japan_21_land,
      "Japan Hazard Map 21 Contour" : hazard_map_japan_21_contour,
      "Japan Hazard Map 21 Contour Land" : hazard_map_japan_21_contour_land,
      "Japan Hazard Map 22" : hazard_map_japan_22,
      "Japan Hazard Map 22 Land" : hazard_map_japan_22_land,
      "Japan Hazard Map 22 Contour" : hazard_map_japan_22_contour,
      "Japan Hazard Map 22 Contour Land" : hazard_map_japan_22_contour_land,
      "Japan Hazard Curve" : hazard_curve_Japan,
      "Japan Hazard Curve Land" : hazard_curve_Japan_land,
      "World Hazard Map" : hazard_map,
      "World Hazard Map Contour" : hazard_contour,
      "World Hazard Curve" : hazard_curve,     
      "GRUMP Urban" : grump_urban,
      "GRUMP Rural" : grump_rural,
    };

    // create the map
    var map = L.map('map', {
        center: [20, 20],
        zoom: 3,
        maxZoom: 9,
        layers: [osm, GEM_base]
    });

    map.on('zoomend', onZoomend);

    var latlonTopLeft = "";
    var latlonBottomRight = "";
    
    L.control.layers(baselayer, overlays).addTo(map);

    // Add Wax support
    L.wax(map);
        </script>       </script>
    </script>
        <span id="showGrid"></span>
{% endblock %}

