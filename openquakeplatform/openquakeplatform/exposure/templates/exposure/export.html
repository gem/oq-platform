<!--
   Copyright (c) 2015, GEM Foundation.

      This program is free software: you can redistribute it and/or modify
      it under the terms of the GNU Affero General Public License as
      published by the Free Software Foundation, either version 3 of the
      License, or (at your option) any later version.

      This program is distributed in the hope that it will be useful,
      but WITHOUT ANY WARRANTY; without even the implied warranty of
      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
      GNU Affero General Public License for more details.

      You should have received a copy of the GNU Affero General Public License
      along with this program.  If not, see <https://www.gnu.org/licenses/agpl.html>.
-->

<!-- todo put this back -->
{% extends "data_viewer_base.html" %}

{% block title %}
Exposure Export {{ block.super }}
{% endblock title %}

{% block extra_head %}
    {{block.super}}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/leaflet.draw.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}Leaflet.Coordinates/Leaflet.Coordinates-0.1.2.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}css/exposure-legend.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}exposure/exposure-export.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}exposure/bootstrap.css" />
{% endblock extra_head %}

{% block body_outer %}
{{block.super}}

<div id="cover" ><img id="download-button-spinner" src="{{ STATIC_URL }}img/ajax-loader.gif" /></div>
{% verbatim %}
<div ng-app="exposureApp" >
  <div id="countriesListDialog" title="Admin Level 0 Selection Table">
  <div ng-controller="ExposureCountryList">
    <div id="countryList">
    {% endverbatim %}
    <div id="national-spinner" >Loading ...<img id="download-button-spinner" src="{{ STATIC_URL }}img/ajax-loader.gif" /></div>
    {% verbatim %}
      <table ng-table="tableParams" show-filter="true" class="table ng-table-rowselected">
        <tr ng-repeat="record in $data" ng-click="record.$selected = !record.$selected; changeSelection(record)"
            ng-class="{'active': record.$selected}">
          <td data-title="'Name'" filter="{ 'country_name': 'text' }">{{record.country_name}}</td>
          <td data-title="'Number of Studies'">{{record.num_studies}}</td>
          <td data-title="'Study'">{{record.study_name}}</td>
          <td data-title="'Has Non-Residential'">{{record.has_nonres}}</td>
        </tr>
      </table>
    </div>
  </div>

    <div id="subRegionList" ng-controller="ExposureRegionList">
      <div ng-include="template.url"></div>
      <input ng-controller="ExposureCountryList" type="button" id="subRegionListBack" ng-click="emptySubRegionTable()" value="< Back">
    </div>


    <div id="selectionForm">
      <div id="countrySelectionForm">
        <div id="nationalForm" >
          <form id="exposure-building-form" class="exposure_export_form">
            <p><b>Download Study Wide Building/Dwelling Fractions:</b></p>
            <button id="dwellingFractionsDownload"  type="button" value="{{selectedStudy}}">Download</button><br><br>
            <b>Download Gridded Building Exposure:</b><br>
            <p><label for="id_residential_0">Building Type:</label><br>
            <label for="id_residential_0"><input class="exposure_export_widget" id="id_residential_0" name="residential" type="radio" checked="" value="residential" /> Residential</label><br>
            <label id="id_residential_1_text" for="id_residential_1"><input class="exposure_export_widget" id="id_residential_1" name="residential" type="radio" value="non-residential" /> Non-Residential</label><br>
            </p>
            <p><label for="id_outputType_0">Output Type:</label><br>
            <label for="id_outputType_0"><input class="exposure_export_widget" id="id_outputType_0" name="outputType" type="radio" checked="" value="csv" /> CSV</label><br>
            <label for="id_outputType_1"><input class="exposure_export_widget" id="id_outputType_1" name="outputType" type="radio" value="nrml" /> NRML</label><br>
            </p>
            <input type="hidden" name="study" value="{{selectedStudy}}">
            <br>
            <button id="nationalExposureBldgDownload" type="button">Download</button>
          </form>
          <div id="drawBoundingMsg">
            <p>The selected study region is too large to be downloaded in it&#39s entirety. To proceed you will need to draw a bounding box over the map to make a sub-selection of the region</p>
            <button id="selectBbox" type="button">Proceed</button>
            <br><br>
          </div>
          <input type="button" id="selectionFormBack" value="< Back">
        </div>
        <div id="subNationalForm">
          <form id="sub-exposure-building-form" class="exposure_export_form">
            <p><b>Download Region Wide Building/Dwelling Fractions:</b></p><button id="subDwellingFractionsDownload" type="button" value="{{selectedSubStudy}}">Download</button><br><br>
            <b>Download Gridded Sub-National Building Exposure:</b><br>
            <p><label for="id_residential_0">Building Type:</label><br>
            <label for="id_residential_0"><input class="exposure_export_widget" id="id_residential_0" name="sub-residential" type="radio" checked="" value="residential" /> Residential</label><br>
            <label id="id_residential_1_text" for="id_residential_1"><input class="exposure_export_widget" id="id_residential_1" name="sub-residential" type="radio" value="non-residential" /> Non-Residential</label><br>
            </p>
            <p><label for="id_outputType_0">Output Type:</label><br>
            <label for="id_outputType_0"><input class="exposure_export_widget" id="id_outputType_0" name="sub-outputType" type="radio" checked="" value="csv" /> CSV</label><br>
            <label for="id_outputType_1"><input class="exposure_export_widget" id="id_outputType_1" name="sub-outputType" type="radio" value="nrml" /> NRML</label><br>
            </p>
            <input type="hidden" name="sub-study" value="{{study_region_id}}">
            <br>
            <button id="subNationalExposureBldgDownload" type="button">Download</button>
            <div id="sub-exposure-building-form-too-large">
              <p>The selected study region is too large to be downloaded in it&#39s entirety. To proceed you will need to draw a bounding box over the map to make a sub-selection of the region</p>
                <button id="subSelectBbox" type="button">Proceed</button>
            </div>
          </form>
        </div>

      </div>
    </div>
    <div id="subRegionForm">
      <input type="button" id="subRegionFormBack" value="< Back">
    </div>
  </div>
</div>
{% endverbatim %}

<div id="export_form_placeholder" style="display:none"></div>

<!-- Placeholder div for holding/displaying error messages/dialogs -->
<div id="error-dialog"></div>
{% endblock body_outer %}

{% block extra_script %}
    {{block.super}}

    <script>
    // URL params, captured and rendered to the template:
    var URL_PARAMS = {};
    {% for k, v in request.GET.iteritems %}
    URL_PARAMS.{{ k }} = "{{ v }}";
    {% endfor %}
    </script>

    <script type="text/javascript" src="{{ STATIC_URL }}Leaflet.draw/dist/leaflet.draw.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}Leaflet.Coordinates/Leaflet.Coordinates-0.1.2.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}exposure/exposure_export.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}exposure/exposure_controller.js"></script>

    <script>
        help=document.getElementById("help_url");
        if(typeof help !== "undefined") { help.href+='/exposure/'; }
    </script>
{% endblock extra_script %}
