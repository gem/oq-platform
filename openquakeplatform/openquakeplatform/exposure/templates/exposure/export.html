<!--
Copyright (c) 2010-2013, GEM Foundation.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/agpl.html>.
-->

{% extends "data_viewer_base.html" %}

{% block title %}
Exposure Export {{ block.super }}
{% endblock title %}

{% block extra_head %}
    {{block.super}}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/leaflet.draw.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}Leaflet.Coordinates/Leaflet.Coordinates-0.1.2.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}css/exposure-legend.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}exposure/exposure-export.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}exposure/bootstrap.css" />
{% endblock extra_head %}

{% block body_outer %}
{{block.super}}

<div id="cover" ><img id="download-button-spinner" src="{{ STATIC_URL }}img/ajax-loader.gif" /></div>
{% verbatim %}
<div ng-app="exposureApp" >
  <div id="countriesListDialog" title="Admin Level 0 Selection Table">
    <div id="countryList" ng-controller="ExposureCountryList">
    <div id="national-spinner" >Loading ...<img id="download-button-spinner" src="{{ STATIC_URL }}img/ajax-loader.gif" /></div>
      <table ng-table="tableParams" show-filter="true" class="table ng-table-rowselected">
        <tr ng-repeat="record in $data" ng-click="record.$selected = !record.$selected; changeSelection(record)"
                ng-class="{'active': record.$selected}">
          <td data-title="'Name'" filter="{ 'country_name': 'text' }">{{record.country_name}}</td>
          <td data-title="'Number of Studies'">{{record.num_l1_studies}}</td>
          <td data-title="'Study'">{{record.study_name}}</td>
          <td data-title="'Has Non-Residential'">{{record.has_nonres}}</td>
        </tr>
      </table>
    </div>
    <div id="subRegionList" ng-controller="ExposureRegionList">
      <div id="ragionTable">
      <div id="subnational-spinner" >Loading ...<img id="download-button-spinner" src="{{ STATIC_URL }}img/ajax-loader.gif" /></div>
        <table ng-table="tableParams2" show-filter="true" class="table ng-table-rowselected">
          <tr ng-repeat="record in $data" ng-click="record.$selected = !record.$selected; changeSelection(record)"
                  ng-class="{'active': record.$selected}">
            <td data-title="'Region Level 1'" filter="{ 'g1name': 'text' }">{{record.g1name}}</td>
            <td data-title="'Region Level 2'" filter="{ 'g2name': 'text' }">{{record.g2name}}</td>
          </tr>
        </table>
      </div>
      <input type="button" id="subRegionListBack" value="< Back">
    </div>
    <div id="selectionForm">
      <div id="countrySelectionForm"></div>
      <input type="button" id="selectionFormBack" value="< Back">
    </div>
    <div id="subRegionForm">
      <input type="button" id="subRegionFormBack" value="< Back">
    </div>
  </div>
</div>
{% endverbatim %}

<div id="export_form_placeholder" style="display:none"></div>

<!-- Placeholder div for holding/displaying error messages/dialogs -->
<div id="error-dialog"></div>
{% endblock body_outer %}


{% block extra_script %}
    {{block.super}}
    <script>
    // URL params, captured and rendered to the template:
    var URL_PARAMS = {};
    {% for k, v in request.GET.iteritems %}
    URL_PARAMS.{{ k }} = "{{ v }}";
    {% endfor %}
    </script>

    <script type="text/javascript" src="{{ STATIC_URL }}Leaflet.draw/dist/leaflet.draw.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}Leaflet.Coordinates/Leaflet.Coordinates-0.1.2.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}exposure/exposure_export.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}exposure/exposure_controller.js"></script>

    <script>
        help=document.getElementById("help_url");
        if(typeof help !== "undefined") { help.href+='/exposure/'; }
    </script>
{% endblock extra_script %}
