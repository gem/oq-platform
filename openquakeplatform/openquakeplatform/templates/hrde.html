<!--
Copyright (c) 2014, GEM Foundation.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/agpl.html>.
-->
{% extends "data_viewer_base.html" %}

{% block extra_head %}
    {{block.super}}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/hrde.css" />
{% endblock extra_head %}

{% block title %}
Explore - {{block.super}}
{% endblock %}

{% block body_outer %}
{% include "base_map_options.html" %}
{% verbatim %}


<button type="button" id="hazard-data">Load Hazard Data</button>
<button type="button" id="risk-data">Load Risk Data</button>
<button type="button" id="legend">Legend</button>
<button type="button" id="help">Help</button>

<div ng-app="testApp">
<div id="worning-no-layer" title="Woops!" class="ui-helper-hidden">
    <p>This layer is not loaded in the map</p>
</div>
  
  <div id="chartDialog" title="Plot" style="overflow: hidden;"></div>
  <div id="legendDialog" title="Legend" style="overflow: hidden;"></div>
  <div id="helpDialog" title="Help" style="overflow: hidden;">
    <h2>Hazard & Risk Data Explorer</h2>
    <p>The Hazard & Risk Data Explorer is customized web application for exploring GEM hazard and risk models</p>
    
    <ul>
      <li><b>Base Layers:</b>
        <dl>On the top left of the toolbar one can select alternative base maps</dl>
      </li>

      <li><b>Loading layers into the map:</b>
        <dl>Select 'Load Hazard Data' or 'Load Risk Data'. From the respective dialog one can choose to load layers into the map</dl>

        <dl>Multiple hazard map layers can be loaded into the map simultaneously. This is not the case for all other layers (curves & input models). For these types of layers, each time a layer is added, the previously loaded layer is automatically removed from the map, while hazard maps layers will remain in the map</dl>
        
        <dl>Once a hazard map has been selected and loaded, the layer transparency can be adjusted in the Hazard Data dialog using the slider</dl>

        <dl>Each layer that is added to the map gets added to the layer controller <img src="{{ STATIC_URL }}/Leaflet/dist/images/layers.png" alt="controller image" style="width:26px;height:26px">, from the controller layers can be turned on and off</dl>

        <dl>When adding hazard maps the order in which layers are added to the map matters, new layers will be rendered on top of previously added layers</dl>

      </li>
      <li><b>Interactivity:</b>
        <dl>Hazard maps: hover the mouse over each hazard map and view the point value in the dialog popup (bottom right)</dl>
        <dl>Curves and input models: click points in the grid on the map layer to render the curve(s) into the plot dialog</dl>
        <dl>Zoom in on the map to get more detail</dl>
        <dl>Curve plots: hover the mouse over any point along the line to view it's value</dl>
        <dl>Inside the plot dialog one can download a CSV that will incude the values of the plot</dl>
      </li>
      <li><b>Legend:</b>
        <dl>Only the hazard map and input model layers have a thematic representation that can be described by a legend</dl>
        <dl>Each time a hazard map or input model layer is loaded into the map, a legend is automatically displayed into the legend dialog. When closed, this dialog can be opened again by clicking the 'Legend' button in the toolbar </dl>
      </li>
    </ul>

  </div>
  <div id="hazardDataDialog" title="Hazard Data" style="overflow: hidden;">
    <form id="tile-form-list-curves">
      <br>Select Category:<br>
      <select id="hazard-curve-category"></select>
      <br/>

      <!-- Input model dropdown -->
      <div ng-controller="HazardInputDropdown">
        <br>Input Models:<br>
        Filter <input type="text" ng-model="search">
        <br>
        <select id="input-list" size="5" ng-model="selected_input" ng-options="input.name for input in inputs | filter:search | orderBy:'name'">
          <option value="0"></option>
        </select>
        <br>
        <input type="button" id="addTileInput" value="Add Layer">
        <input type="button" id="removeTileInput" value="Remove Layer">
        <br>
      </div>

      <!-- Hazard Maps dropdown -->
      <div ng-controller="HazardMapDropdown">
        <br>Hazard Maps:<br>
        Filter <input type="text" ng-model="search">
        <br>
        <select size="5" id="layer-list" ng-model="selected_map" ng-options="map.name for map in maps | filter:search | orderBy:'name'">
          <option></option>
        </select>
        <br>
        <input type="button" id="addTileLayer" value="Add Layer">
        <input type="button" id="removeTileLayer" value="Remove Layer">
        <div id="transparency-labels">
        <p> 
          <label class="transparency-label" for="amount">Layer transparency:</label> 
          <input type="text" id="amount" readonly style="width:30px">
        </p>
      </div>
      <div id="transparency-slider"></div>
      </div>
      <br/>

      <!-- Hazard Curve dropdown -->
      <div ng-controller="HazardCurveDropdown">
        <br>Hazard Curves:<br>
        Filter <input type="text" ng-model="search">
        <br>
        <select id="curve-list" size="5" ng-model="selected_curve" ng-options="curve.name for curve in curves | filter:search | orderBy:'name'"></select>
        <br>
        <input type="button" id="addTileCurve" value="Add Layer">
        <input type="button" id="removeTileCurve" value="Remove Layer">
        <br>
      </div>

      <!-- UHS Curve dropdown -->
      <div ng-controller="UhsDropdown">
        <br>Uniform Hazard Spectra:<br>
        Filter <input type="text" ng-model="search">
        <br>
        <select id="uhs-list" size="5" ng-model="selected_uhs" ng-options="uhs.name for uhs in uhss | filter:search | orderBy:'name'"></select>
        <br>
        <input type="button" id="addTileUhs" value="Add Layer">
        <input type="button" id="removeTileUhs" value="Remove Layer">
        <br>
      </div>
  </div>

  <div id="riskDataDialog" title="Risk Data" style="overflow: hidden;">
    <form id="risk-form-list-curves">
      <br>Risk Models:<br>
      <select id="risk-curve-category"></select>
      <br>Loss Curves:<br>
      <select id="loss-list"></select><br>
      <input type="button" id="addTileLoss" value="Add Layer">
      <input type="button" id="removeTileLoss" value="Remove Layer">
    </form>
  </div>
  
  <div id="worning-no-layer" title="Woops!" class="ui-helper-hidden">
      <p>This layer is not loaded in the map</p>
  </div>
</div>
{% endverbatim %}
{{block.super}}

{% endblock %}


{% block extra_script %}
    {{block.super}}
    <!-- Category tags-->

    <script src="{{ STATIC_URL }}js/hrde.js"></script>
    <script src="{{ STATIC_URL }}js/base_map_options.js"></script>
    <script src="{{ STATIC_URL }}js/hrdeDrop.js"></script>
    
{% endblock extra_script %}
