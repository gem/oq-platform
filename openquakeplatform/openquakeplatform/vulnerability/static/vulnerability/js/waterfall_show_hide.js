$ = django.jQuery;

var form_name = "generalinformation";

function analytical_model_info_manager(anc_name, is_enabled)
{
    var full_name, rel_name = "analytical_model_info";

    full_name = (anc_name.length > 0 ? anc_name + "-0-" : "" ) + rel_name;

    if (is_enabled) {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', '');
    }
    else {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', 'none');
    }
    related_delete_mgr(full_name, !is_enabled);
    // sub_manager(full_name, is_enabled) ....
}

function empirical_model_info_manager(anc_name, is_enabled)
{
    var full_name, rel_name = "empirical_model_info";

    full_name = (anc_name.length > 0 ? anc_name + "-0-" : "" ) + rel_name;

    if (is_enabled) {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', '');
    }
    else {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', 'none');
    }
    related_delete_mgr(full_name, !is_enabled);
    // sub_manager(full_name, is_enabled) ....
}

function fragility_func_manager(anc_name, is_enabled)
{
    var full_name, rel_name = "fragility_func";

    full_name = (anc_name.length > 0 ? anc_name + "-0-" : "" ) + rel_name;

    if (is_enabled) {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', '');
    }
    else {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', 'none');
    }
    related_delete_mgr(full_name, !is_enabled);

    var method_of_estimation;
    indexed_name = full_name + "-0-";
    var select_id = "#"+form_name+"_form select[id=id_"+indexed_name+"method_of_estimation] option:selected";
    method_of_estimation = $(select_id).text();
    $( "#"+form_name+"_form select[id=id_"+indexed_name+"method_of_estimation]" ).change(function () { fragility_func_manager(anc_name, is_enabled) });
    analytical_model_info_manager(full_name, method_of_estimation == "Analytical");
    empirical_model_info_manager(full_name, method_of_estimation == "Empirical");
}

function vulnerability_func_manager(anc_name, is_enabled)
{
    var full_name, rel_name = "vulnerability_func";

    full_name = (anc_name.length > 0 ? anc_name + "-0-" : "" ) + rel_name;

    if (is_enabled) {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', '');
    }
    else {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', 'none');
    }    
    related_delete_mgr(full_name, !is_enabled);
    // sub_manager(full_name, is_enabled) ....
    var method_of_estimation;
    indexed_name = full_name + "-0-";
    var select_id = "#"+form_name+"_form select[id=id_"+indexed_name+"method_of_estimation] option:selected";
    method_of_estimation = $(select_id).text();
    $( "#"+form_name+"_form select[id=id_"+indexed_name+"method_of_estimation]" ).change(function () { vulnerability_func_manager(anc_name, is_enabled) });
    analytical_model_info_manager(full_name, method_of_estimation == "Analytical");
    empirical_model_info_manager(full_name, method_of_estimation == "Empirical");
}

function damage_to_loss_func_manager(anc_name, is_enabled)
{
    var full_name, rel_name = "damage_to_loss_func";

    full_name = (anc_name.length > 0 ? anc_name + "-0-" : "" ) + rel_name;

    if (is_enabled) {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', '');
    }
    else {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', 'none');
    }    
    related_delete_mgr(full_name, !is_enabled);
     //sub_manager(full_name, is_enabled) ....
    var method_of_estimation;
    indexed_name = full_name + "-0-";
    var select_id = "#"+form_name+"_form select[id=id_"+indexed_name+"method_of_estimation] option:selected";
    method_of_estimation = $(select_id).text();
    $( "#"+form_name+"_form select[id=id_"+indexed_name+"method_of_estimation]" ).change(function () { damage_to_loss_func_manager(anc_name, is_enabled) });
    analytical_model_info_manager(full_name, method_of_estimation == "Analytical");
    empirical_model_info_manager(full_name, method_of_estimation == "Empirical");
}

function capacity_curve_func_manager(anc_name, is_enabled)
{
    var full_name, rel_name = "capacity_curve_func";

    full_name = (anc_name.length > 0 ? anc_name + "-0-" : "" ) + rel_name;

    if (is_enabled) {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', '');
    }
    else {
        $( "div[id='"+full_name+"-group'][.class='inline-group']" ).css('display', 'none');
    }    
    related_delete_mgr(full_name, !is_enabled);
     //sub_manager(full_name, is_enabled) ....
}

function related_delete_mgr(full_name, to_del)
{
    var el = $("#"+form_name+"_form input[id='id_"+full_name+"-0-DELETE']");

    // console.log("#"+form_name+"_form input[id='id_"+full_name+"-0-DELETE'], to_del="+(to_del ? "true" : "false"));
    if (el.length == 1) {
        if (to_del) {
            el.attr('checked','checked');
        }
        else {
            el.removeAttr('checked');
        }
    }
}


function general_information_manager(is_enabled) {
    var type_of_assessment;

    type_of_assessment = $( "#"+form_name+"_form select[id=id_type_of_assessment] option:selected" ).text();
    $( "#"+form_name+"_form select[id=id_type_of_assessment]" ).change(function () { general_information_manager(true) });

    fragility_func_manager("", type_of_assessment == "Fragility");
    vulnerability_func_manager("", type_of_assessment == "Vulnerability");
    damage_to_loss_func_manager("", type_of_assessment == "Damage-to-loss");
    capacity_curve_func_manager("", type_of_assessment == "Capacity curve");
}

$(document).ready(function() {
    general_information_manager(true);
});
