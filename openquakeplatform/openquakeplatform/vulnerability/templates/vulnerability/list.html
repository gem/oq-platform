{% extends "site_base.html" %}
{% load i18n %}

{% block title %} {% trans page_title %} {% endblock title %}
{% block indexclass %} class="here" {% endblock indexclass %}
{% block body_class %}bodyclass{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ STATIC_URL }}css/d3.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}vulnerability/css/vulnerability.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}vulnerability/css/fragility.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}vulnerability/css/damage.css" />
<link rel="stylesheet" href="{{ STATIC_URL }}vulnerability/css/capacity.css" />
<script src="{{ STATIC_URL }}js/d3.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript"><!--
var global_id = null;
var gl;
function entry_select(obj, id) {
    global_id = id;
    $("[id^='list_entry']").removeClass("list_entry_selected");
    $(obj).addClass("list_entry_selected");
}
//-->
</script>
<style>
body.bodyclass { height: 100%; margin: 0px; padding: 0px;}

div.liquid_content {
    position: absolute;
    width: 100%;
    top: 235px;
    bottom: 45px;
    background-color: #ffddff;
}

div.list_func_container {
    position: absolute;
    display: block;
    top: 0px;
    bottom: 0px;
    width: 25%;
    background-color: #f3f0ef;
    overflow: auto;
    border: 1px solid grey;
}

div.preview_container {
    position: absolute;
    width: 75%;
    right: 0px;
    top: 0px;
    bottom: 0px;
    background-color: #ffffff;
    border: 1px solid grey;
}

div.list_func {
    padding: 8px;
}

div.list_entry {
    color: #1b75a7;
    cursor: pointer;
}

div.list_entry:hover {
    text-decoration: underline;
}

div.list_entry_selected {
    background-color: white;
    color: black;
}

div.list_entry_selected:hover {
    background-color: white;
    color: black;
}

ul.vuln_menu
{
    width:100%;
    padding: 7px 0px 7px 0px;
    margin:0;
    list-style-type:none;
    background-image: url('{{STATIC}}/static/img/OQ_header_bg.png');
    background-position: left bottom;
    border-bottom: 1px solid #1b75a7;
}

li.vuln_menu {
    display:inline;
    color: black;
    margin: 0px;
    padding: 8px;
}

li.vuln_menu_selected {
    display:inline;
    color: black;
    background-color: #ffffff;
    margin: 0px;
    padding: 8px;
    border: 1px solid #1b75a7;
    border-bottom: 1px solid white;
}

a.vuln_menu
{
    width:6em;
    color: #1b75a7;
    padding:0.2em 0.6em;
}

a.vuln_menu:hover {
    text-decoration:underline;
}

div.filters {
    padding: 90px;
    min-width: 900px;
}

input, textarea, .uneditable-input {
    width: 150px;
}

select {
    width: auto;
}

div.filters form table {
  margin: auto;
}

div.filters form table td {
  text-align: right;
  padding: 4px;
}

</style>
{{ block.super }}
{% endblock %}

{% block middle %}
    <div class="main">
      <ul class="vuln_menu">
        {% for toa_key,toa_value in types_of_assessment.items %}{% if toa_key == type_of_assessment %}<li class="vuln_menu_selected">{{toa_value}}</li>{% else %}<li class="vuln_menu"><a class="vuln_menu" href="?type_of_assessment={{toa_key}}">{{toa_value}}</a></li>{% endif %}{% endfor %}
      </ul>
      <div class="filters">
          <form action="/vulnerability/list/?type_of_assessment={{ type_of_assessment }}" method="post">
              <table>

                <tr>
              {% for item in form2 %}
                  <td>
                  {{ item.field.label }}:
                  {{ item.field }}
                  </td>
              {% endfor %}
                </tr>

                <tr>
              {% for item in form1 %}
                  <td>
                  {{ item.field.label }}:
                  {{ item.field }}
                  </td>
              {% endfor %}
                  <td>
                    <input type="submit" value="Filter" />
                  </td>
                </tr>

              </table>
              {% csrf_token %}
          </form>
      </div>
    </div>
    <div class="liquid_content">
      <div class="list_func_container">
        <div class="list_func">
          <!-- Geninfo  -->
          {% for gi_cur in geninfo %}
          <div id="list_entry" class="list_entry" onclick="entry_select(this, {{ gi_cur.id }});">{{ gi_cur }}</div>
          {% endfor %}
        </div>
      </div>
      <div class="preview_container">
        <input type="submit" value="Show" name="_show" onclick="if (global_id != null) { window.open('/vulnerability/view/'+global_id+'/', 'vulnerability_view_'+global_id); }; return false;"/>
        <div id="mainApp" class="main_app">
      </div>
    </div>

    <script type="text/javascript">

    $('.list_entry').click(function() {
        $('#mainApp').empty();

        // Get the JSON object
        $.getJSON('{{STATIC}}/vulnerability/data/'+global_id, function (data) {   
            gl = jQuery.parseJSON(data);
            var functionType = gl.fields.type_of_assessment;

            if (functionType == "Fragility") {
                $.getScript("{{ STATIC_URL }}vulnerability/js/fragility_curves.js", function(){
                });
                $('#mainApp').append(
                '<div id="fragilityChart"></div>'
                ) 
            }
            else if (functionType == "Vulnerability") {
                $.getScript("{{ STATIC_URL }}vulnerability/js/vulnerability_curves.js", function(){
                });
    
                $('#mainApp').append(
                  '<div id="vulnerabilityChart"></div>'
                )
            } 
            else if (functionType == "Capacity curve") {
                $.getScript("{{ STATIC_URL }}vulnerability/js/capacity_curves.js", function(){
                });
    
                $('#mainApp').append(
                  '<div id="capacityChart"></div>'
                )
            } 
            else if (functionType == "Damage-to-loss") {
                $.getScript("{{ STATIC_URL }}vulnerability/js/damage_to_loss.js", function(){
                });
    
                $('#mainApp').append(
                  '<div id="damageChart"></div>'
                )
            }
        });
    });
  
    </script>

{% endblock %}
